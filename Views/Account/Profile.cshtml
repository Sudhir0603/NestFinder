@model NestFinder.Models.ApplicationUser
@using Microsoft.AspNet.Identity;
@{
    ViewBag.Title = "My Profile";
    var userId = User.Identity.GetUserId();
}

<div class="container mt-4">
    <h2 class="text-center text-primary">My Profile</h2>

    <div class="profile-card shadow-lg p-4 rounded">
        <!-- Profile Photo Section -->
        <div class="text-center">
            <img src="@Model.ProfilePictureUrl" id="profileImage" class="rounded-circle img-thumbnail"
                 style="width: 120px; height: 120px; object-fit: cover;">
            <input type="file" id="uploadProfilePic" class="d-none" accept="image/*">
            <button class="btn btn-outline-primary btn-sm mt-2" onclick="document.getElementById('uploadProfilePic').click();">
                Change Photo
            </button>
        </div>

        <!-- User Information -->
        <div class="mt-3">
            <h4 class="text-center">@Model.FullName</h4>
            <p class="text-center text-muted">@Model.Email</p>
        </div>

        <!-- User Details -->
        <div class="mt-4">
            <h5>Personal Information</h5>
            <div class="row">
                <div class="col-6"><strong>Phone:</strong> @Model.PhoneNumber</div>
                <div class="col-6"><strong>City:</strong> @Model.City</div>
            </div>
            <div class="row mt-2">
                <div class="col-6"><strong>State:</strong> @Model.State</div>
                <div class="col-6"><strong>Joined:</strong> @Model.JoinDate.ToShortDateString()</div>
            </div>
        </div>

        <!-- View Uploaded Properties -->
        <div class="mt-4">
            <h5>My Uploaded Properties</h5>
            <div id="userProperties" class="row">
                @foreach (var property in ViewBag.UserProperties)
                {
                    <div class="col-md-6 mb-3">
                        <div class="card shadow-sm">
                            <img src="@property.ImageUrls.Split(';')[0]" class="card-img-top" style="height: 150px; object-fit: cover;">
                            <div class="card-body">
                                <h5 class="card-title">@property.Title</h5>
                                <p class="card-text text-muted">@property.City, @property.State</p>
                                <p><strong>Price:</strong> ₹@property.Price</p>
                                <a href="@Url.Action("Details", "Property", new { id = property.Id })" class="btn btn-primary btn-sm">View</a>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>

        <!-- Edit Profile Button -->
        <div class="text-center mt-4">
            <a href="@Url.Action("EditProfile", "Account")" class="btn btn-warning">Edit Profile</a>
        </div>
    </div>
</div>

<!-- ✅ JavaScript for Uploading Profile Picture -->
<script>
    document.getElementById("uploadProfilePic").addEventListener("change", function () {
        var file = this.files[0];
        var reader = new FileReader();

        reader.onload = function (e) {
            document.getElementById("profileImage").src = e.target.result;

            fetch('@Url.Action("UploadProfilePicture", "Account")', {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ imageUrl: e.target.result })
            })
            .then(response => response.json())
            .then(data => alert("Profile picture updated!"))
            .catch(error => console.error("❌ Error:", error));
        };

        reader.readAsDataURL(file);
    });
</script>

<!-- ✅ Styling for Profile Page -->
<style>
    .profile-card {
        max-width: 500px;
        margin: auto;
        background: #fff;
        border-radius: 10px;
        padding: 20px;
    }

        .profile-card h4 {
            margin-bottom: 5px;
        }

        .profile-card .btn {
            width: 100%;
        }
</style>
