@model List<NestFinder.Models.TotalUsersViewModel>

@{
    ViewBag.Title = "Total Users Report";
}

<div class="container mt-4">
    <h2 class="text-center text-primary fw-bold mb-4">Total Users Report</h2>

    <!-- Back Button -->
    <div class="text-end">
        <a href="@Url.Action("Dashboard", "Admin")" class="btn btn-outline-primary mb-3">
            <i class="fas fa-arrow-left"></i> Back to Admin Dashboard
        </a>
    </div>

    <!-- Total Users Card -->
    <div class="card shadow-lg border-0 rounded-4 p-4 text-center" style="background: linear-gradient(135deg, #4A90E2, #72C6EF);">
        <i class="fas fa-users fa-3x text-white"></i>
        <h4 class="text-white mt-2">Total Registered Users</h4>
        <h2 class="text-white fw-bold">@Model.Count</h2>
    </div>

    <!-- Download Button -->
    <div class="text-end mt-3">
        <button id="downloadUsersBtn" class="btn btn-success shadow-lg">
            <i class="fas fa-download"></i> Download Report
        </button>
    </div>

    <!-- Users Table -->
    <div class="table-responsive mt-4">
        <table id="usersTable" class="table table-striped table-hover table-bordered shadow-lg">
            <thead class="table-dark">
                <tr>
                    <th>User ID</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Join Date</th>
                    <th>City</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var user in Model)
                {
                    <tr>
                        <td>@user.Id</td>
                        <td>@user.FullName</td>
                        <td>@user.Email</td>
                        <td>@user.JoinDate.ToShortDateString()</td>
                        <td>@user.City</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<!-- JavaScript for CSV Download -->
<script>
    document.getElementById("downloadUsersBtn").addEventListener("click", function () {
        let csvContent = "User ID, Name, Email, Join Date, City\n";

        document.querySelectorAll("#usersTable tbody tr").forEach(row => {
            let columns = row.querySelectorAll("td");
            let rowData = [];
            columns.forEach(column => rowData.push(column.innerText));
            csvContent += rowData.join(",") + "\n";
        });

        let blob = new Blob([csvContent], { type: "text/csv" });
        let link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "TotalUsersReport.csv";
        link.click();
    });
</script>
